<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="./leaflet.css"/>

	<script src="./leaflet.js"></script>
	<script src="./Leaflet.ImageOverlay.Rotated.js"></script>
	<script src="./ors-js-client.js"></script>
</head>
<body>
   <div id="map"></div>
   <div>
		<button id='buttonPlus' onclick='changeFloor(1)'></button>
		<button id='buttonMinus' onclick='changeFloor(-1)'></button>
		<button id='buttonFindMe' onclick='findMe()'></button>

   </div>
   
	<script type="text/javascript">
		var libraryLoc = [46.194927185965064, 6.139895360858279]
		var mymap = L.map('map').setView(libraryLoc, 20);
		L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
		    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
		    maxZoom: 30,
		    id: 'mapbox/streets-v11',
		    tileSize: 512,
		    zoomOffset: -1,
		    accessToken: 'pk.eyJ1IjoiY29pbG0iLCJhIjoiY2t3Zzh6ejllMG05cjJvbWp1czZwd2d5NSJ9.yZexSLCkOBQwDR5xD5aLIg'
		}).addTo(mymap);

		var p1 = L.latLng(46.19485999832131, 6.138750314712524);
		var p2 = L.latLng(46.19580687978871, 6.1397695541381845);
		var p3 = L.latLng(46.194210168266004, 6.140005588531495);
		var img_link = ['./plan-1-01_App copie_page-0001.jpg', './plan-2-01_App copie_page-0001.jpg'];
		var bookFloor = 0;
		var isLocationFound = false;
		var currentFloor = bookFloor;
		var userLocation = null;
		
		var overlay = L.imageOverlay.rotated(img_link[currentFloor], p1, p2, p3, {
			opacity: 0.7,
			interactive: false,
			attribution: "UniMail"
		});
		mymap.addLayer(overlay);

		function onLocationFound(e){
			var radius = e.accuracy;
			L.marker(e.latlng).addTo(mymap);
			L.circle(e.latlng, radius).addTo(mymap);
			isLocationFound = true;
			userLocation = e.latlng;
		}

		function onLocationError(e){
			alert(e.message);
		}

		function findMe(){
			console.log(isLocationFound);
			if (isLocationFound) {
				console.log('In the if');
				console.log(libraryLoc);
				var corner1 = L.latLng(libraryLoc);
				var corner2 = userLocation;
				var boundaries = L.latLngBounds(corner1, corner2);
				mymap.fitBounds(boundaries);
			}
		}


		mymap.locate(watch=true);

		mymap.on('locationfound', onLocationFound);
		// mymap.on('locationfound', travelPath);
		mymap.on('locationerror', onLocationError);

		function changeFloor(step) {

			if (currentFloor + step < 0){
				currentFloor = 0;
			}
			else if (currentFloor + step > img_link.length - 1){
				currentFloor = img_link.length;
			}
			else{
				currentFloor += step;
				overlay.setUrl(img_link[currentFloor])
			}
				
		}
			
	</script>

</body>
</html>